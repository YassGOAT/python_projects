{% extends 'base.html' %}

{% block content %}

<section class="game-layout">
    <!-- Sidebar historique -->
    <aside class="history-panel">
        <h3>Historique 2 joueurs</h3>

        {% if history and history|length > 0 %}
            <ul class="history-list">
                {% for h in history %}
                    <li class="history-item history-{{ h.result|lower }}">
                        <div class="history-header">
                            <span class="result">{{ h.result }}</span>
                        </div>
                        <div class="history-body">
                            <span class="line">
                                {{ h.p1_name }} : {{ h.p1_score }} /
                                {{ h.p2_name }} : {{ h.p2_score }}
                            </span>
                            {% if h.winner_name %}
                                <span class="line small">
                                    Vainqueur : {{ h.winner_name }}
                                </span>
                            {% else %}
                                <span class="line small">
                                    Aucun vainqueur.
                                </span>
                            {% endif %}
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="history-empty">Aucune partie jouée pour l’instant.</p>
        {% endif %}
    </aside>

    <!-- Zone de jeu principale -->
    <section class="game
        {% if finished %} game-finished{% endif %}
        {% if finished and result == 'Victoire' %} game-win{% endif %}
        {% if finished and result == 'Défaite' %} game-lose{% endif %}
        {% if finished and result == 'Égalité' %} game-draw{% endif %}
    ">
        <div class="top-bar">
            <div>Joueur 1 : <span>{{ player1_name }}</span></div>
            <div>Joueur 2 : <span>{{ player2_name }}</span></div>
            <div>Tour actuel :
                <span>
                    {% if current_turn == 'p1' %}
                        {{ player1_name }}
                    {% else %}
                        {{ player2_name }}
                    {% endif %}
                </span>
            </div>
        </div>

        <div class="table">
            <!-- Main du joueur 2 -->
            <div class="hand dealer">
                <h3>{{ player2_name }}</h3>
                <div class="cards">
                    {% for card in player2_hand.cards %}
                        <div class="card {% if card.suit in ['Cœur','Carreau'] %}red{% endif %}">
                            <span class="value">{{ card.value }}</span>
                            <span class="suit">
                                {% if card.suit == 'Pique' %}♠
                                {% elif card.suit == 'Trèfle' %}♣
                                {% elif card.suit == 'Carreau' %}♦
                                {% elif card.suit == 'Cœur' %}♥
                                {% endif %}
                            </span>
                        </div>
                    {% endfor %}
                </div>
                <p class="score">Score : {{ player2_score }}</p>
            </div>

            <!-- Main du joueur 1 -->
            <div class="hand player">
                <h3>{{ player1_name }}</h3>
                <div class="cards">
                    {% for card in player1_hand.cards %}
                        <div class="card {% if card.suit in ['Cœur','Carreau'] %}red{% endif %}">
                            <span class="value">{{ card.value }}</span>
                            <span class="suit">
                                {% if card.suit == 'Pique' %}♠
                                {% elif card.suit == 'Trèfle' %}♣
                                {% elif card.suit == 'Carreau' %}♦
                                {% elif card.suit == 'Cœur' %}♥
                                {% endif %}
                            </span>
                        </div>
                    {% endfor %}
                </div>
                <p class="score">Score : {{ player1_score }}</p>
            </div>
        </div>

        {% if message %}
            <p class="message">{{ message }}</p>
        {% endif %}

        {% if not finished %}
            <div class="actions">
                <a class="btn primary" href="{{ url_for('hit_pvp') }}" data-sound="card">
                    Tirer
                </a>
                <a class="btn secondary" href="{{ url_for('stand_pvp') }}" data-sound="click">
                    Rester
                </a>
            </div>
        {% else %}
            <div class="actions">
                <a class="btn primary" href="{{ url_for('index') }}" data-sound="click">
                    Nouvelle manche
                </a>
            </div>
        {% endif %}
    </section>
</section>

{% endblock %}
